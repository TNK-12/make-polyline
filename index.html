<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>現在地テスト</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- UserMarker -->
<script src="https://tnk-12.github.io/test_v1/leaflet.usermarker.js"></script>
<link rel="stylesheet" href="https://tnk-12.github.io/test_v1/leaflet.usermarker.css">

<style>
  #map { height: 100vh; width: 100%; }
  #debug { padding: 10px; font-size: 14px; }
</style>
</head>

<body>

<div id="map"></div>
<div id="debug"></div>



<script>

const map = L.map('map').setView([35.0, 135.0], 15);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

let userMarker = null;


//let map = L.map('map');
let marker = null;
let path = [];
let polyline = L.polyline([], {
  color: 'red',
  weight: 4
}).addTo(map);

navigator.geolocation.watchPosition(
  (pos) => {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;
    const current = [lat, lng];

    // 初回
    if (!marker) {
      map.setView(current, 17);
      marker = L.marker(current).addTo(map);

      path.push(current);
      polyline.setLatLngs(path);
      return; // ← 初回はここで終了してOK
    }

    // 2回目以降
    const last = path[path.length - 1];
    const dist = map.distance(last, current);

    //10mごとに更新
   
   
      path.push(current);
      polyline.setLatLngs(path);
      console.log(current);
    

    marker.setLatLng(current);
    map.panTo(current);
  },
  (err) => {
    alert("位置情報エラー: " + err.message);
  },
  {
    enableHighAccuracy: true,
    maximumAge: 0,
    timeout: 10000
  }
);
</script>
